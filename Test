--=============================================================
--  CONFIG (ตั้งเองใน Apps Script)
--=============================================================
local GoogleScriptURL = "https://script.google.com/macros/s/AKfycbwev0J0v6CTL4r2Lkl9wQ4IIcxFv3zabHXBsT5a5qB8AtrQ_BTPe0vzdlH_2kzqxznSEA/exec"
local TOKEN = "SLEEPHUB-KEY-SECRET-928371"

local HttpService = game:GetService("HttpService")
local Player = game.Players.LocalPlayer

-- HWID ป้องกันสปูฟระดับพื้นฐาน
local HWID = game:GetService("RbxAnalyticsService"):GetClientId() .. "_" .. Player.UserId



--=============================================================
--  ฟังก์ชันตรวจสอบคีย์ผ่าน Google Sheet
--=============================================================
local function CheckKey(USER_KEY)
    local Data = {
        key = USER_KEY,
        hwid = HWID,
        username = Player.Name,
        token = TOKEN
    }

    local Body = HttpService:JSONEncode(Data)

    local request = syn and syn.request or http_request or request or (http and http.request)

    if not request then
        return false, "⚠ ไม่รองรับ Executor นี้"
    end

    local Response = request({
        Url = GoogleScriptURL,
        Method = "POST",
        Headers = { ["Content-Type"] = "application/json" },
        Body = Body
    })

    if not Response then
        return false, "❌ ไม่สามารถเชื่อมต่อเซิร์ฟเวอร์ได้"
    end

    local Result = HttpService:JSONDecode(Response.Body)
    return Result.status, Result.message
end



--=============================================================
--  โหลด Rayfield
--=============================================================
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "SLEEP HUB",
   Icon = 121030902371363,
   LoadingTitle = "SLEEP HUB",
   LoadingSubtitle = "by SLEEP HUB",
   Theme = "Dark Blue",
   ToggleUIKeybind = "K",

   KeySystem = true,
   KeySettings = {
      Title = "SLEEP HUB | Key System",
      Subtitle = "ระบบตรวจสอบคีย์ Google Sheet",
      Note = "ใส่คีย์ที่ได้รับจากระบบ",
      SaveKey = false,
      GrabKeyFromSite = false,
      Key = {"SLEEP_HUB_PLACEHOLDER"} -- ไม่ใช่คีย์จริง
   }
})

Rayfield:LoadConfiguration()



--=============================================================
--  Prompt ให้กรอกคีย์ + ตรวจสอบคีย์จริง
--=============================================================
Rayfield:Prompt({
    Title = "ระบบตรวจสอบคีย์",
    Subtitle = "กรอกคีย์ของคุณ",
    Input = {
        Placeholder = "ใส่คีย์...",
        Type = "Default"
    },

    Callback = function(UserKey)
        local status, msg = CheckKey(UserKey)

        if status == "success" then
            Rayfield:Notify("สำเร็จ", msg, 5)
            getgenv().SLEEP_KEY = UserKey
        else
            Rayfield:Notify("ล้มเหลว", msg, 5)
            task.wait(2)
            Player:Kick(msg)
        end
    end
})



--=============================================================
--  โหลด Script เฉพาะเกม Kayak and Surf
--=============================================================
repeat task.wait() until game:IsLoaded()

local KayakAndSurf = game.PlaceId == 136404558442020

if KayakAndSurf then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/sleephub-pro/SLRRP-HUB/refs/heads/main/Kayak%20and%20Surf"))()
    print("[SLEEP HUB] Loaded: Kayak and Surf Script")
else
    Player:Kick("ไม่รองรับเกมนี้")
    task.wait(2)
    game:Shutdown()
end
