--=====================================
--  CONFIG  (ปรับตามที่ตั้งไว้ใน Apps-Script)
--=====================================
local GoogleScriptURL = "https://script.google.com/macros/s/AKfycbwev0J0v6CTL4r2Lkl9wQ4IIcxFv3zabHXBsT5a5qB8AtrQ_BTPe0vzdlH_2kzqxznSEA/exec"
local GoogleToken     = "SLEEHUBPRO"   -- ตรงกับ TOKEN ใน Apps-Script

-- ถ้าไม่อยากใช้ KeySystem ให้ตั้ง false
local UseKeySystem    = true

--=====================================
--  ฟังก์ชันช่วย
--=====================================
local HttpService = game:GetService("HttpService")
local Players     = game:GetService("Players")

-- อ่าน HWID ง่ายๆ (ใช้ UserId + ชื่อเครื่อง)
local function GetHWID()
    local id = tostring(Players.LocalPlayer.UserId)
    local name = tostring(game:GetService("RunService"):IsStudio() and "Studio" or
                          (pcall(function() return game:GetService("RbxAnalyticsService"):GetClientId() end)) and
                          game:GetService("RbxAnalyticsService"):GetClientId() or "NoClientId")
    return HttpService:JSONEncode({id,name}) -- แปลงเป็น string ยาวๆ
end

-- ถาม key จากผู้ใช้ (ใช้ Rayfield หรือ Input ธรรมดาก็ได้)
local function PromptKey()
    local key = nil
    -- ใครใช้ Rayfield อยู่แล้วแทนตรงนี้ได้เลย
    key = _G.KeyInput or nil
    while not key or key=="" do
        key = Players.LocalPlayer:RequestString("Key Required","Please enter your key:","") or ""
        wait()
    end
    return key
end

-- ตรวจสอบกับ Google-Sheet
local function CheckKeyOnline(key,hwid)
    local url = GoogleScriptURL.. "?action=check&token="..GoogleToken..
                "&key="..HttpService:UrlEncode(key).."&hwid="..HttpService:UrlEncode(hwid)
    local suc,res = pcall(function() return HttpService:GetAsync(url) end)
    if not suc then return 'error' end
    return res   -- ค่าที่ส่งกลับ: passed / invalid_key / hwid_mismatch / invalid_token
end

--=====================================
--  เริ่มทำงาน
--=====================================
repeat wait() until game:IsLoaded()

local KayakAndSurf = game.PlaceId == 136404558442020
if not KayakAndSurf then
    Players.LocalPlayer:Kick("ไม่รองรับเกมนี้")
    wait(3)
    game:Shutdown()
    while true do end
end

-- ขั้นตอน KeySystem
if UseKeySystem then
    local hwid = GetHWID()
    local key  = PromptKey()
    local resp = CheckKeyOnline(key,hwid)
    if resp ~= 'passed' then
        Players.LocalPlayer:Kick("Key ไม่ถูกต้อง หรือ HWID ไม่ตรง ("..resp..")")
        wait(3)
        game:Shutdown()
        while true do end
    end
    print("Key & HWID ผ่าน!")
end

-- โหลดสคริปต์หลัก
loadstring(game:HttpGet("https://raw.githubusercontent.com/sleephub-pro/SLRRP-HUB/refs/heads/main/Kayak%20and%20Surf"))()
print("Loaded: Kayak and Surf Script")
